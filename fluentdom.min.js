var FluentDOM=function(a){var b={DOMParser:"undefined"!=typeof DOMParser?DOMParser:require("xmldom").DOMParser,XMLSerializer:"undefined"!=typeof XMLSerializer?XMLSerializer:require("xmldom").XMLSerializer,DOMImplementation:"undefined"!=typeof document?document.implementation:new(require("xmldom").DOMImplementation)};if("undefined"!=typeof document){if(!document.evaluate&&"undefined"==typeof xpath)throw"No Xpath support available";b.XPath="undefined"==typeof xpath?{}:xpath,b.XPathResult="undefined"!=typeof XPathResult?XPathResult:xpath.XPathResult}else b.XPath=require("xpath"),b.XPathResult=require("xpath").XPathResult;var c=function(a,d,e){var f,g={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,validate:function(a,b){return b>0?a instanceof Object&&a.nodeType==b:a instanceof Object&&a.nodeType>0}};if(!(this instanceof c))return new c(a,d,e);if("string"==typeof d&&(e=d),e="string"==typeof e?e:"text/xml",g.validate(a,g.DOCUMENT_NODE))f=a;else if(a&&a!==!0)if(c.loaders instanceof Object&&c.loaders[e])f=c.loaders[e](a,e);else{if("string"!=typeof a||"text/xml"!=e&&"text/html"!=e)throw"Can not load source as "+e;f=(new b.DOMParser).parseFromString(a,e)}else f=a||"undefined"==typeof document?b.DOMImplementation.createDocument("","",null):document;f&&!f.evaluate&&(f.evaluate=function(a,c,d,e){if(0>e||e>9)throw{code:0,toString:function(){return"Request type not supported"}};return b.XPath.createExpression(a,d).evaluate(c,e,null)});var h=function(a){this.result=a,this.items=[]};h.prototype.toArray=function(){var a=[];return this.each(function(){a.push(this)}),a},h.prototype.each=function(a){for(var b,c=0,d=0;d<this.items.length;d++)a.call(this.items[d],c++);if(this.result)for(;b=this.result.iterateNext();)this.items.push(b),a.call(b,c++);this.result=null};var i=function(a){var b;return b=a instanceof Function&&!a.lookupNamespaceURI instanceof Function?a:a&&a.lookupNamespaceURI instanceof Function?a.lookupNamespaceURI:function(a){return a=a instanceof Object?a:{},function(b){return""==b?null:a[b]||null}}(a),b.fromNodeName=function(a){var c;return c=a.indexOf(":")>-1?a.substr(0,a.indexOf(":"))||"":"#default",b(c)},b}(d),j=function(a,b){var c,d;if(g.validate(b))g.validate(b,g.DOCUMENT_NODE)?b.documentElement&&a.appendChild(a.ownerDocument.importNode(b.documentElement,!0)):(b=a.ownerDocument!=b.ownerDocument?a.ownerDocument.importNode(b,!0):b.cloneNode(!0),g.validate(b,g.ATTRIBUTE_NODE)?a.setAttributeNode(b):a.appendChild(b));else if(b instanceof Array){for(c=0;c<b.length;c++)j(a,b[c]);a.appendChild(f.createTextNode(b))}else if(b instanceof Object)for(c in b)b.hasOwnProperty(c)&&((d=i.fromNodeName(c))?a.setAttributeNS(i.fromNodeName(c),c,b[c]):a.setAttribute(c,b[c]));else"string"==typeof b&&a.appendChild(f.createTextNode(b.toString()))};this.create=function(a){var b,c;b=i.fromNodeName(a),c=b?f.createElementNS(b,a):f.createElement(a);for(var d=1;d<arguments.length;d++)j(c,arguments[d]);return c},this.create.cdata=function(a){return f.createCDATASection(a)},this.create.comment=function(a){return f.createComment(a)},this.create.pi=function(a,b){return f.createProcessingInstruction(a,b)},this.create.each=function(a,b){var c,d,e;if(b=b instanceof Function?b:function(a){return a},c=f.createDocumentFragment(),a instanceof Array)for(e=0;e<a.length;e++)d=b(a[e],e),d&&j(c,d);else if(a instanceof Object)for(e in a)a.hasOwnProperty(e)&&(d=b(a[e],e),d&&j(c,d));return c},this.document=function(a){var c;return c=f.documentElement?f.implementation.createDocument("","",null):f,c.appendChild(a),c.save=function(){return(new b.XMLSerializer).serializeToString(f)},c},this.evaluate=function(a,c,d){c=g.validate(c)?c:f,d=d||b.XPathResult.ANY_TYPE;var e=f.evaluate(a,c,{lookupNamespaceURI:i},d,null);switch(e.resultType){case b.XPathResult.BOOLEAN_TYPE:return e.booleanValue;case b.XPathResult.NUMBER_TYPE:return e.numberValue;case b.XPathResult.STRING_TYPE:return e.stringValue;case b.XPathResult.FIRST_ORDERED_NODE_TYPE:return e.singleNodeValue;default:return new h(e)}},this.xml=function(a){var c;return c=a?a:f,(new b.XMLSerializer).serializeToString(c)}};return c.loaders={},"undefined"!=typeof a&&(a.FluentDOM=c),c}("undefined"!=typeof exports?exports:{});