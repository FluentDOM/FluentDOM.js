var FluentDOM=function(dom,resolver){if(window==this)return new FluentDOM(dom,resolver);var namespaces=function(resolver){var result;return result=resolver instanceof Function&&!resolver.lookupNamespaceURI instanceof Function?resolver:resolver&&resolver.lookupNamespaceURI instanceof Function?resolver.lookupNamespaceURI:function(list){return list=list instanceof Object?list:{},function(prefix){return""==prefix?null:list[prefix]||null}}(resolver),result.fromNodeName=function(nodeName){var prefix;return prefix=nodeName.indexOf(":")>-1?nodeName.substr(0,nodeName.indexOf(":"))||"":"#default",result(prefix)},result}(resolver),append=function(node,value){var i,namespace;if(value instanceof Node)value instanceof Document?value.documentElement&&node.appendChild(node.ownerDocument.importNode(value.documentElement,!0)):(value=node.ownerDocument!=value.ownerDocument?node.ownerDocument.importNode(value,!0):value.cloneNode(!0),value instanceof Attr?node.setAttributeNode(value):node.appendChild(value));else if(value instanceof Array){for(i=0;i<value.length;i++)append(node,value[i]);node.appendChild(dom.createTextNode(value))}else if(value instanceof Object)for(i in value)value.hasOwnProperty(i)&&((namespace=namespaces.fromNodeName(i))?node.setAttributeNS(namespaces.fromNodeName(i),i,value[i]):node.setAttribute(i,value[i]));else"string"==typeof value&&node.appendChild(dom.createTextNode(value.toString()))};this.create=function(name){var namespace,node;namespace=namespaces.fromNodeName(name),node=namespace?dom.createElementNS(namespace,name):dom.createElement(name);for(var i=1;i<arguments.length;i++)append(node,arguments[i]);return node},this.create.cdata=function(content){return dom.createCDATASection(content)},this.create.comment=function(content){return dom.createComment(content)},this.create.pi=function(content){return dom.createProcessingInstruction(content)},this.create.each=function(list,callback){var fragment,node,i;if(callback=callback instanceof Function?callback:function(item){return item},fragment=dom.createDocumentFragment(),list instanceof Array)for(i=0;i<list.length;i++)node=callback(list[i],i),node&&append(fragment,node);else if(list instanceof Object)for(i in list)list.hasOwnProperty(i)&&(node=callback(list[i],i),node&&append(fragment,node));return fragment},this.document=function(node){var result;return result=dom.documentElement?dom.implementation.createDocument("","",null):dom,result.appendChild(node),result.save=function(){return(new XMLSerializer).serializeToString(dom)},result},dom===!0?dom=document.implementation.createDocument("","",null):dom instanceof Document||(dom=document)};