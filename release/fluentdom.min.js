var FluentDOM=function(a,b,c){var d;if(window==this)return new FluentDOM(a,b,c);if("string"==typeof b&&(c=b),c="string"==typeof c?c:"text/xml",a instanceof Document)d=a;else if(a===!0)d=document.implementation.createDocument("","",null);else if(void 0===a||null===a)d=document;else if(FluentDOM.loaders instanceof Object&&FluentDOM.loaders[c])d=FluentDOM.loaders[c](a,c);else{if("string"!=typeof a||"text/xml"!=c&&"text/html"!=c)throw"Can not load source as "+c;d=(new DOMParser).parseFromString(a,c)}d&&!d.evaluate&&"undefined"!=typeof installDOM3XPathSupport&&installDOM3XPathSupport(d,new XPathParser);var e=function(a){this.result=a,this.items=[]};e.prototype.toArray=function(){var a=[];return this.each(function(){a.push(this)}),a},e.prototype.each=function(a){for(var b,c=0,d=0;d<this.items.length;d++)a.call(this.items[d],c++);if(this.result)for(;b=this.result.iterateNext();)this.items.push(b),a.call(b,c++);this.result=null};var f=function(a){var b;return b=a instanceof Function&&!a.lookupNamespaceURI instanceof Function?a:a&&a.lookupNamespaceURI instanceof Function?a.lookupNamespaceURI:function(a){return a=a instanceof Object?a:{},function(b){return""==b?null:a[b]||null}}(a),b.fromNodeName=function(a){var c;return c=a.indexOf(":")>-1?a.substr(0,a.indexOf(":"))||"":"#default",b(c)},b}(b),g=function(a,b){var c,e;if(b instanceof Node)b instanceof Document?b.documentElement&&a.appendChild(a.ownerDocument.importNode(b.documentElement,!0)):(b=a.ownerDocument!=b.ownerDocument?a.ownerDocument.importNode(b,!0):b.cloneNode(!0),b instanceof Attr?a.setAttributeNode(b):a.appendChild(b));else if(b instanceof Array){for(c=0;c<b.length;c++)g(a,b[c]);a.appendChild(d.createTextNode(b))}else if(b instanceof Object)for(c in b)b.hasOwnProperty(c)&&((e=f.fromNodeName(c))?a.setAttributeNS(f.fromNodeName(c),c,b[c]):a.setAttribute(c,b[c]));else"string"==typeof b&&a.appendChild(d.createTextNode(b.toString()))};this.create=function(a){var b,c;b=f.fromNodeName(a),c=b?d.createElementNS(b,a):d.createElement(a);for(var e=1;e<arguments.length;e++)g(c,arguments[e]);return c},this.create.cdata=function(a){return d.createCDATASection(a)},this.create.comment=function(a){return d.createComment(a)},this.create.pi=function(a){return d.createProcessingInstruction(a)},this.create.each=function(a,b){var c,e,f;if(b=b instanceof Function?b:function(a){return a},c=d.createDocumentFragment(),a instanceof Array)for(f=0;f<a.length;f++)e=b(a[f],f),e&&g(c,e);else if(a instanceof Object)for(f in a)a.hasOwnProperty(f)&&(e=b(a[f],f),e&&g(c,e));return c},this.document=function(a){var b;return b=d.documentElement?d.implementation.createDocument("","",null):d,b.appendChild(a),b.save=function(){return(new XMLSerializer).serializeToString(d)},b},this.evaluate=function(a,b,c){b=b instanceof Node?b:d,c=c||XPathResult.ANY_TYPE;var g=d.evaluate(a,b,{lookupNamespaceURI:f},c,null);switch(g.resultType){case XPathResult.BOOLEAN_TYPE:return g.booleanValue;case XPathResult.NUMBER_TYPE:return g.numberValue;case XPathResult.STRING_TYPE:return g.stringValue;case XPathResult.FIRST_ORDERED_NODE_TYPE:return g.singleNodeValue;default:return new e(g)}}};FluentDOM.loaders={};